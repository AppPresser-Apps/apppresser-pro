import{r as t,f as i,h as o}from"./p-7ebfe9a9.js";import{n as s}from"./p-dd8c7f8a.js";import{B as n}from"./p-2a50c6c9.js";import{s as a}from"./p-1f120eb8.js";import{A as e}from"./p-1abc5f76.js";import"./p-d7663053.js";import"./p-9b3d931a.js";import"./p-67e2a233.js";import"./p-28e84784.js";import"./p-6351a5dd.js";import"./p-d1311ccb.js";import"./p-d6593782.js";import"./p-2d180048.js";import"./p-42947fc3.js";const p=class{constructor(o){t(this,o),this.activityReply=i(this,"activityReply",7),this.activityPost=i(this,"activityPost",7),this.activityReload=i(this,"activityReload",7),this.posting=!1,this.placeholder="Post a status update...",this.reply=!1,this.item=void 0,this.args=void 0,this.data=void 0}componentWillLoad(){console.log(this.item,this.data),this.placeholder=this.reply?"Post a reply...":this.placeholder,this.bpService=new n({url:this.item.api})}async activityPostEvent(t){console.log(this.reply),this.reply||this.activityPost.emit(t),this.reply&&this.activityReply.emit({item:t,parent:this.item.id})}async dismissLoader(){(await document.querySelector("ion-loading")).dismiss()}async dismissModal(){(await document.querySelector("ion-modal")).dismiss({dismissed:!0})}async addActivity(){var t;if(""!==this.content&&!this.posting){const i=await s.create({message:"",cssClass:"ion-loading-spinner"});setTimeout((()=>{i.present()}),50),this.posting=!0;const o=Object.assign({content:this.content},null!==(t=this.args)&&void 0!==t?t:{component:"activity",context:"edit",type:"activity_update"});let n;if(this.reply&&(o.type="activity_comment",o.primary_item_id=this.item.id),e.attachments.length>0?(o.attachments=e.attachments,this.content||(o.content="<span></span>"),n=await this.bpService.uploadAttachmentActivity(o)):n=await this.bpService.addActivity(o),console.log("reply",this.reply,n),n&&!n.hasOwnProperty("error")){const t=[n[0],...a.activity];this.reply?(console.log("reply"),this.activityReply.emit({item:n[0],parent:this.item.id})):(a.activity=[...t],this.activityPostEvent(n),a.activity_item=[],this.activityReload.emit(),document.querySelector("ion-router").push("/activity/"+(this.reply?n[0].primary_item_id:n[0].id)))}e.attachments=[],this.posting=!1,this.dismissLoader(),this.dismissModal()}}updateContent(t){this.content=t.target.value}get postingToGroup(){var t;return"groups"===(null===(t=this.args)||void 0===t?void 0:t.component)}get groupName(){var t;return null===(t=this.data)||void 0===t?void 0:t.api.name}render(){return[o("ion-header",null,o("ion-toolbar",null,o("ion-buttons",{slot:"start"},o("ion-button",{onClick:()=>this.dismissModal()},o("ion-icon",{slot:"icon-only",name:"close"}))),o("ion-title",null),o("ion-buttons",{slot:"end"},o("ion-button",{style:{width:"80px"},fill:"clear",color:"primary",onClick:()=>this.addActivity()},"Post")))),o("ion-content",null,o("div",{class:"post-form"},o("ion-textarea",{style:{fontSize:"14px"},rows:4,cols:10,placeholder:this.placeholder,onIonChange:t=>this.updateContent(t)})),this.postingToGroup&&o("div",{class:"ion-padding-top ion-padding-start",style:{fontSize:"12px"}},o("ion-icon",{name:"return-down-back-outline"})," posting to ",this.groupName),this.reply&&o("div",{class:"ion-padding-top ion-padding-start",style:{fontSize:"12px"}},o("ion-icon",{name:"return-down-back-outline"})," replying to ",this.item.display_name),o("attachments-grid",null)),o("ion-footer",null,o("ion-toolbar",null,o("ion-buttons",{slot:"start"},o("attachment-button",null))))]}};p.style="app-post-form{display:block}.post-form{padding:16px;background:#efefef}.loading-wrapper.sc-ion-loading-ios{padding-top:0px !important;padding-bottom:0px !important;padding-inline-end:19px !important}";export{p as app_post_form}