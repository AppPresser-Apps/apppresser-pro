import{C as a,a as t,b as e}from"./p-7e321e49.js";import{P as s}from"./p-c8e2e9a8.js";import{E as o}from"./p-a190c3e1.js";import{a as r}from"./p-ac8f2b47.js";import{k as n,m as i}from"./p-5147e882.js";class c{constructor(){this.user_data=null}componentWillLoad(){this.loadUser()}async loadUser(){const a=(await s.get({key:"auth"})).value;this.user_data=JSON.parse(a)}async promptEditAvatar(){const t=r("desktop");(await n.create({header:"Choose an image",buttons:[{text:"From Library",handler:()=>t?this.getPhotoFromFileSystem():this.getPhoto(a.Photos)},{text:"From Camera",handler:()=>this.getPhoto(a.Camera)}]})).present()}async getPhoto(a){const s=await t.getPhoto({allowEditing:!0,resultType:e.Uri,source:a});this.openAvatarModal({avatarUrl:s.webPath})}async getPhotoFromFileSystem(){const a=document.createElement("input");a.setAttribute("accept","image/*"),a.setAttribute("type","file"),a.addEventListener("change",(()=>{const t=a.files[0];if(t){const a=URL.createObjectURL(t);this.openAvatarModal({avatarUrl:a})}})),a.click()}async uploadAvatar(a){const t=new File([a],"image/png"===a.type?"image.png":"image.jpg",{type:a.type}),e=new FormData;e.append("context","edit"),e.append("action","bp_avatar_upload"),e.append("file",t);const s=await this.getAuthHeaders(),o=await fetch(`${this.getBaseUrl()}/wp-json/buddypress/v1/members/${this.user_data.user_id}/avatar`,{method:"POST",headers:s,body:e});if(o.status>=400)throw o.json();const r=await o.json();return this.updateAvatarOnPreferences(r[0].full),r}async openAvatarModal(a){const t=await i.create({componentProps:Object.assign({},a),component:"appp-avatar-modal"});return t.present(),t}async updateAvatarOnPreferences(a){const t=(await s.get({key:"auth"})).value,e=JSON.parse(t);e.user.avatar_urls.full=a,e.user.avatar_urls.thumb=a,s.set({key:"auth",value:JSON.stringify(e)})}async getAuthHeaders(){return{Authorization:`Bearer ${this.user_data.token}`}}getBaseUrl(){return o.api_url}}export{c as A}