import{W as e,b as t}from"./p-d6593782.js";import{C as a,c as o}from"./p-e5ca7938.js";import"./p-2d180048.js";class n extends e{async getPhoto(e){return new Promise((async(t,o)=>{if(e.webUseInput||e.source===a.Photos)this.fileInputExperience(e,t);else if(e.source===a.Prompt){let a=document.querySelector("pwa-action-sheet");a||(a=document.createElement("pwa-action-sheet"),document.body.appendChild(a)),a.header=e.promptLabelHeader||"Photo",a.cancelable=!1,a.options=[{title:e.promptLabelPhoto||"From Photos"},{title:e.promptLabelPicture||"Take Picture"}],a.addEventListener("onSelection",(async a=>{0===a.detail?this.fileInputExperience(e,t):this.cameraExperience(e,t,o)}))}else this.cameraExperience(e,t,o)}))}async pickImages(e){return new Promise((async e=>{this.multipleFileInputExperience(e)}))}async cameraExperience(e,a,n){if(customElements.get("pwa-camera-modal")){const i=document.createElement("pwa-camera-modal");i.facingMode=e.direction===o.Front?"user":"environment",document.body.appendChild(i);try{await i.componentOnReady(),i.addEventListener("onPhoto",(async o=>{const s=o.detail;null===s?n(new t("User cancelled photos app")):s instanceof Error?n(s):a(await this._getCameraPhoto(s,e)),i.dismiss(),document.body.removeChild(i)})),i.present()}catch(t){this.fileInputExperience(e,a)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(e,a)}fileInputExperience(e,t){let n=document.querySelector("#_capacitor-camera-input");const i=()=>{var e;null===(e=n.parentNode)||void 0===e||e.removeChild(n)};n||(n=document.createElement("input"),n.id="_capacitor-camera-input",n.type="file",n.hidden=!0,document.body.appendChild(n),n.addEventListener("change",(()=>{const a=n.files[0];let o="jpeg";if("image/png"===a.type?o="png":"image/gif"===a.type&&(o="gif"),"dataUrl"===e.resultType||"base64"===e.resultType){const n=new FileReader;n.addEventListener("load",(()=>{if("dataUrl"===e.resultType)t({dataUrl:n.result,format:o});else if("base64"===e.resultType){const e=n.result.split(",")[1];t({base64String:e,format:o})}i()})),n.readAsDataURL(a)}else t({webPath:URL.createObjectURL(a),format:o}),i()}))),n.accept="image/*",n.capture=!0,e.source===a.Photos||e.source===a.Prompt?n.removeAttribute("capture"):e.direction===o.Front?n.capture="user":e.direction===o.Rear&&(n.capture="environment"),n.click()}multipleFileInputExperience(e){let t=document.querySelector("#_capacitor-camera-input-multiple");t||(t=document.createElement("input"),t.id="_capacitor-camera-input-multiple",t.type="file",t.hidden=!0,t.multiple=!0,document.body.appendChild(t),t.addEventListener("change",(()=>{const a=[];for(let e=0;e<t.files.length;e++){const o=t.files[e];let n="jpeg";"image/png"===o.type?n="png":"image/gif"===o.type&&(n="gif"),a.push({webPath:URL.createObjectURL(o),format:n})}var o;e({photos:a}),null===(o=t.parentNode)||void 0===o||o.removeChild(t)}))),t.accept="image/*",t.click()}_getCameraPhoto(e,t){return new Promise(((a,o)=>{const n=new FileReader,i=e.type.split("/")[1];"uri"===t.resultType?a({webPath:URL.createObjectURL(e),format:i,saved:!1}):(n.readAsDataURL(e),n.onloadend=()=>{const e=n.result;a("dataUrl"===t.resultType?{dataUrl:e,format:i,saved:!1}:{base64String:e.split(",")[1],format:i,saved:!1})},n.onerror=e=>{o(e)})}))}async checkPermissions(){if("undefined"==typeof navigator||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(await window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch(e){throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}}const i=new n;export{i as Camera,n as CameraWeb}